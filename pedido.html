// Enhanced cart functions with localStorage persistence

function saveCartToStorage() {
  localStorage.setItem('fratelli_pazzi_cart', JSON.stringify(carrito));
}

function loadCartFromStorage() {
  const savedCart = localStorage.getItem('fratelli_pazzi_cart');
  if (savedCart) {
    const parsedCart = JSON.parse(savedCart);
    carrito.splice(0, carrito.length, ...parsedCart);
    actualizarCarrito();
  }
}

// Enhanced agregarAlCarrito function
function agregarAlCarrito(nombre, precio, buttonElement) {
  const existente = carrito.find(p => p.nombre === nombre);
  if (existente) {
    existente.cantidad++;
  } else {
    carrito.push({ nombre, precio, cantidad: 1 });
  }
  
  saveCartToStorage(); // Save to localStorage
  actualizarCarrito();
  mostrarNotificacion(nombre + ' aÃ±adido al carrito');
}

// Enhanced eliminarDelCarrito function
function eliminarDelCarrito(nombre) {
  const index = carrito.findIndex(p => p.nombre === nombre);
  if (index > -1) {
    if (carrito[index].cantidad > 1) {
      carrito[index].cantidad--;
    } else {
      carrito.splice(index, 1);
    }
    saveCartToStorage(); // Save to localStorage
    actualizarCarrito();
    actualizarModalCarrito();
    mostrarNotificacion('Producto eliminado del carrito');
  }
}

// Load cart on page load
document.addEventListener('DOMContentLoaded', function() {
  loadCartFromStorage();
  // ... rest of initialization code
});
